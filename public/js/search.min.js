var timeout;
$("#search").keyup(function() {
	var $this = $(this);
	if(timeout) {
		clearTimeout(timeout);
	}
	timeout = setTimeout(function() {
		var div =document.getElementById("results");
		if ($this.val().length===0) {
			div.innerHTML="";
			div.style.display="none";
			return;
		}
		div.style.display="block";
		if (window.XMLHttpRequest) {
			xmlhttp=new XMLHttpRequest();
		} else {
			xmlhttp=new ActiveXObject("Microsoft.XMLHTTP");
		}
		xmlhttp.open("GET","search?q="+$this.val()+"&content=search&offset=0",true);
		xmlhttp.onreadystatechange=function() {
			if (xmlhttp.readyState==4 && xmlhttp.status==200) {
				document.getElementById("results").innerHTML=xmlhttp.responseText;}};xmlhttp.send();
			}, 1000);
});


function getAjaxData(offset)
{
	var ret;
	$.ajax({
		url : "/search?q="+$('#search').val()+"&content=main&offset="+offset,
		type : "GET",
		dataType:'json',
		success : function(response) {
			for(var i=0;i<response.length;i++){
				document.getElementsByClassName('play-list')[0].innerHTML+='<a href="/watch?v='+response[i].embeded+'" class="nav"><div class="card"><div class="img"><img src="https://img.putlocker.how/'+response[i].img+'"></div><div class="details"><h3 class="title">'+response[i].title+'</h3><p class="all"> Rating :'+response[i].rating+'</p><p class="all"> Year :'+response[i].year+'</p><p class="all"> Genre :'+response[i].genre+'</p></div></div></a>';
			}
			if(offset==0 && response.length==0)
				document.getElementsByClassName('main-content')[0].innerHTML='<p style="margin:auto">No #Result</p>';

		}
	});
}
function search(){
	var offset = 0;
	getAjaxData(0)
	$(window).scroll(function() {
		if($(window).scrollTop()+10 >= $(document).height() - $(window).height()) {
			offset+=16;
			getAjaxData(offset);
		}

	});
}